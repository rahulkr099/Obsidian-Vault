Alright Rahul ‚Äî here comes a **very realistic backend machine coding round** for a **Nested Comment System** (like YouTube, Reddit, or blogs).

This one is _heavily_ used in interviews because it tests:

- tree structures
    
- recursion
    
- parent-child relationships
    
- pagination
    
- clean schema design
    
- querying + sorting
    
- edge cases
    

I‚Äôll keep the wording simple, clean, and forward-thinking.

---

# üí¨ **Backend Machine Coding Round ‚Äî Nested Comment System**

### ‚è± Time Limit: 60‚Äì90 minutes

### üéØ Goal

Build a backend system that supports:

- Creating comments
    
- Replying to comments (nested replies)
    
- Fetching comments in a nested tree
    
- Editing/deleting comments
    
- Pagination for top-level comments
    
- Soft delete logic
    
- Clean recursive structure
    

Use Node.js + MongoDB/SQL.

---

# üìù **Problem Statement**

Design a **nested comment system** where users can:

- Comment on a post
    
- Reply to another comment
    
- See comments in a hierarchical tree
    
- Edit their comments
    
- Delete (soft delete) comments
    
- Load replies on demand
    
- Paginate top-level comments
    

This should behave like a mini Reddit/YouTube comment engine.

---

# üì¶ **Comment Model**

```json
{
  "id": "c101",
  "postId": "p55",
  "userId": "u22",
  "parentId": null,         // null = top-level comment
  "content": "Nice post!",
  "isDeleted": false,
  "createdAt": "...",
  "updatedAt": "..."
}
```

For replies:

```json
{
  "id": "c102",
  "postId": "p55",
  "userId": "u50",
  "parentId": "c101",       // reply to comment c101
  "content": "Thank you!",
  "isDeleted": false
}
```

---

# üîß **Required Endpoints**

```
POST   /comments
GET    /comments/:postId
PUT    /comments/:id
DELETE /comments/:id
```

---

# üí° **Functional Requirements**

## **1Ô∏è‚É£ Create Comment / Reply ‚Äî POST /comments**

Input:

```json
{
  "postId": "p55",
  "userId": "u22",
  "content": "Nice article!",
  "parentId": null
}
```

Rules:

- parentId optional (for reply)
    
- Validate post exists
    
- Validate parent comment belongs to same post
    
- Save comment with timestamps
    
- Return created comment
    

---

## **2Ô∏è‚É£ Fetch Comments (Nested) ‚Äî GET /comments/:postId**

Supports:

- pagination for top-level comments:
    
    ```
    ?page=1&limit=10
    ```
    
- reply depth unlimited
    
- load entire tree OR lazy loading
    
- sorting new ‚Üí old
    

Expected response structure:

```json
[
  {
    "id": "c101",
    "content": "Nice post!",
    "userId": "u22",
    "replies": [
      {
        "id": "c102",
        "content": "Thanks!",
        "userId": "u50",
        "replies": [...]
      }
    ]
  }
]
```

### Should support:

- Lazy loading of replies:
    
    ```
    GET /comments/:postId?parentId=c101
    ```
    
- Soft deleted comments:
    
    - If isDeleted = true ‚Üí show:
        
        ```
        content: "[deleted]"
        ```
        

---

## **3Ô∏è‚É£ Edit Comment ‚Äî PUT /comments/:id**

Input:

```json
{
  "content": "Updated comment"
}
```

Rules:

- Only author can edit
    
- Cannot edit deleted comment
    
- Update `updatedAt`
    

---

## **4Ô∏è‚É£ Delete Comment ‚Äî DELETE /comments/:id**

Rules:

- Soft delete:
    
    - Set `isDeleted = true`
        
    - Keep replies intact
        
- Replace content with `"[deleted]"`
    

---

# üß™ **Edge Cases Interviewers Will Test**

### Comment Creation

- Replying to a comment of another post ‚Üí reject
    
- Empty content ‚Üí reject
    
- ParentId refers to non-existent comment ‚Üí reject
    

### Fetching Comments

- Large reply chains (deeply nested)
    
- Large number of comments ‚Üí ensure pagination
    
- Soft-deleted parents with active replies
    
- Prevent recursion loops (parentId=itself)
    

### Delete

- Deleting a parent comment with nested replies
    
- Multiple deletions
    
- Deleted comment still appears with placeholder
    

### Edit

- Editing deleted comment ‚Üí reject
    
- Editing someone else‚Äôs comment ‚Üí reject
    

---

# üß± **Backend Design Requirements**

### Should support two approaches:

---

## **Option A: Recursive Fetch (MongoDB example)**

For each top-level comment:

- recursively fetch replies
    
- nest them into tree
    

### Pros:

- simple
    

### Cons:

- many DB calls for deep threads
    

---

## **Option B: Single Query + Tree Build (recommended)**

Example SQL:

```
SELECT * FROM comments WHERE postId = ?
ORDER BY createdAt ASC;
```

Then build tree using:

- `parentId`
    
- map of arrays
    

### Pros:

- performant
    

### Cons:

- heavier in-memory structure
    

---

# ‚≠ê **Interviewer Follow-Up Questions**

1. How to handle **very deep nested replies** efficiently?
    
2. How would you implement **like/dislike** for comments?
    
3. How to fetch **comments with pagination at every level**?
    
4. How do Reddit/YouTube handle thousands of comments?
    
5. How to scale across multiple servers?
    
6. How to avoid **N+1 query problem**?
    
7. Should deleted comments hide replies or keep them?
    
8. How to limit nesting to N levels?
    
9. How to support **real-time new comment updates** (WebSockets)?
    
10. How to support **upvote sorting**?
    

---

# üåü **Bonus Features (Great to Impress)**

- Analytics: number of replies, depth count
    
- Comment ranking algorithm
    
- Caching for comment trees
    
- Push notifications for replies
    
- @mentions in comments
    
- Attachment support (images, GIFs)
    
- Pin top comments
    
- Abuse-reporting & moderation system
    
- Markdown support
    

---

If you want the next backend round, I can prepare:

‚û°Ô∏è **23. Social Feed System (Posts + Likes + Pagination)**  
‚û°Ô∏è **24. Analytics Event Collector API**  
‚û°Ô∏è **25. Audit Logging System**  
‚û°Ô∏è **26. Permissions & Roles Backend**

Just tell me the next one, Rahul!