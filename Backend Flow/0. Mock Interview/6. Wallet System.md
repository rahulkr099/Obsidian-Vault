Alright Rahul, here comes a **production-grade, interview-quality backend machine coding round question** for a **Wallet System** ‚Äî one of the toughest and most frequently asked backend topics because it checks **consistency, transactions, concurrency, and business rules**.

I‚Äôll keep it simple in words but deep in logic so you train like a pro.

---

# ‚úÖ **Backend Machine Coding Round ‚Äî Wallet System**

### **‚è± Time Limit:** 75‚Äì90 minutes

### **üéØ Goal:** Build a digital **Wallet Service** with:

- Creating wallets
    
- Adding balance
    
- Deducting balance
    
- Transferring money between users
    
- Recording transaction history (audit log)
    
- Ensuring strong consistency & safe operations
    

---

# **üìù Problem Statement**

Design and implement a **Wallet Backend System** that allows users to:

- Create a wallet
    
- Add money
    
- Deduct money
    
- Transfer money to another user
    
- View transaction history
    

You may use:

- **Node.js / Express**
    
- **SQL DB (recommended)** or in-memory
    
- **Transaction support** (atomic operations)
    

Clean architecture required:

- **Routes**
    
- **Controller**
    
- **Service (business logic)**
    
- **Data Access Layer**
    

---

# **üëõ Wallet Model Structure**

```json
{
  "id": "uuid",
  "userId": "uuid",
  "balance": 0,
  "createdAt": timestamp,
  "updatedAt": timestamp
}
```

---

# **üìú Transaction Model Structure**

```json
{
  "id": "uuid",
  "walletId": "uuid",
  "type": "CREDIT" | "DEBIT" | "TRANSFER_IN" | "TRANSFER_OUT",
  "amount": number,
  "referenceId": "uuid",  // for transfers, links both sides
  "balanceAfter": number,
  "createdAt": timestamp
}
```

---

# **üîß Required Endpoints**

```
POST   /wallet/create
POST   /wallet/add
POST   /wallet/deduct
POST   /wallet/transfer
GET    /wallet/:id
GET    /wallet/:id/transactions
```

---

# **üí° Functional Requirements**

### **1Ô∏è‚É£ Create Wallet ‚Äî POST /wallet/create**

- Input: `{ userId }`
    
- If wallet already exists ‚Üí return 409
    
- Create wallet with:
    
    - balance = 0
        
    - timestamps
        

---

### **2Ô∏è‚É£ Add Balance ‚Äî POST /wallet/add**

- Input: `{ walletId, amount }`
    
- Validate:
    
    - amount > 0
        
- Atomic Update:
    
    - Increase balance
        
    - Create `CREDIT` transaction
        

---

### **3Ô∏è‚É£ Deduct Balance ‚Äî POST /wallet/deduct**

- Input: `{ walletId, amount }`
    
- Validate:
    
    - amount > 0
        
    - balance >= amount
        
- Atomic Update:
    
    - Decrease balance
        
    - Create `DEBIT` transaction
        

---

### **4Ô∏è‚É£ Transfer Money ‚Äî POST /wallet/transfer**

- Input:
    

```json
{
  "fromWalletId": "...",
  "toWalletId": "...",
  "amount": 500
}
```

Rules:

- Both wallets must exist
    
- amount > 0
    
- From-wallet must have sufficient balance
    
- Atomic Transaction (ACID):
    
    - Deduct from sender
        
    - Add to receiver
        
    - Create two linked transactions:
        
        - TRANSFER_OUT
            
        - TRANSFER_IN
            
- Must **not** allow partial success (strong consistency)
    

---

### **5Ô∏è‚É£ Get Wallet ‚Äî GET /wallet/:id**

- Return:
    
    - walletId
        
    - userId
        
    - balance
        
    - createdAt
        
    - updatedAt
        

---

### **6Ô∏è‚É£ Transaction History ‚Äî GET /wallet/:id/transactions**

- Return ordered list (latest first)
    
- Support optional filters:
    
    - `?type=DEBIT`
        
    - `?limit=20&page=1`
        
- Return paginated response
    

---

# **üß™ Edge Cases to Handle**

- Adding or deducting with amount ‚â§ 0 ‚Üí reject
    
- Deducting more than balance ‚Üí 400
    
- Transfer to same wallet ‚Üí reject
    
- Transfer amount ‚â§ 0 ‚Üí reject
    
- Multiple requests at same time ‚Üí prevent race conditions
    
- Wallet not found ‚Üí 404
    
- In-memory DB: handle concurrency using locks
    
- SQL DB: use transactions (BEGIN, COMMIT, ROLLBACK)
    
- Large values ‚Üí ensure integer overflow doesn‚Äôt occur
    
- Round-off precision (money should not use float!)
    
    - Use **DECIMAL** or integer paise
        
- Ensure transaction history always matches final balance
    

---

# **üîí Consistency / Safety Requirements**

This is where interviewers judge you the most:

- All money movements must be **atomic**
    
- Use transactions or locking to avoid:
    
    - Double spending
        
    - Dirty reads
        
    - Lost updates
        
- Every credit/debit/transfer must create a transaction log entry
    
- Never store money in floats
    

---

# **üßæ Example Transaction Entry**

```json
{
  "id": "txn_245",
  "walletId": "wallet_11",
  "type": "DEBIT",
  "amount": 150,
  "balanceAfter": 350,
  "referenceId": null,
  "createdAt": "2025-01-10T10:02:00Z"
}
```

---

# ‚≠ê Interviewer Follow-Up Questions

1. How would you ensure **atomicity** of transfer in distributed systems?
    
2. Why should money use **DECIMAL** type instead of float?
    
3. How would you detect and prevent **double spending**?
    
4. How would you add **transaction rollback** on failure?
    
5. How would you implement **idempotency** for API calls?
    
6. How would you add **limits** (daily limit, transaction limit)?
    
7. How would you add **bank withdrawal & deposit integration**?
    
8. How would you add **fraud detection rules**?
    

---

# üåü Bonus Features (Impressive Add-ons)

- Idempotency keys for safe repeated requests
    
- Daily/monthly transaction limit logic
    
- OTP-based approval for high-value transfers
    
- Webhook notifications for transactions
    
- Add categories (food, recharge, etc)
    
- CSV export of transaction history
    
- Multi-currency wallet
    
- Freeze wallet feature
    
- Auto-retry failed transactions
    

---

If you want the next backend problem, I can prepare:

‚û°Ô∏è **7. Rate Limiting + Caching (Redis)**  
‚û°Ô∏è **8. Order + Payment Workflow**  
‚û°Ô∏è **9. File Upload System (S3 + Validation)**  
‚û°Ô∏è **10. Real-time Notification System**

Just say the next one!